import argparse
import os
from api_graph import api_graph


def main():
    parser = argparse.ArgumentParser(description='Convert Cuckoo JSON reports to API behavior graphs')
    parser.add_argument('input_dir')
    parser.add_argument('output_dir')
    parser.add_argument('malign')
    args = parser.parse_args()

    input_dir = args.input_dir
    output_dir = args.output_dir
    malign = args.malign
    if malign == '0':
        malign = 0
    elif malign == '1':
        malign = 1
    else:
        print('Error: Malign must be 0 or 1')
        return

    global_seqs = set()
    filename_to_seqs = dict()

    for filename in os.listdir(input_dir):
        all_seqs = api_graph(f'{input_dir}/{filename}')
        filename_to_seqs[filename] = all_seqs
        for seq in all_seqs:
            global_seqs.add(seq)

    # Do one hot encoding
    for filename in filename_to_seqs:
        local_seqs = filename_to_seqs[filename]
        one_hot = list()
        for seq in global_seqs:
            if seq in local_seqs:
                one_hot.append(1)
            else:
                one_hot.append(0)


if __name__ == '__main__':
    main()
